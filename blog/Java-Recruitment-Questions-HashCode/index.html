<!-- This layout is used in all pages. Making changes here will efect all pages. We recommend not to change anything here. --> <!DOCTYPE html><html lang="en"> <!----><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="Cghc1HFx2GBn1D5ans5vLlaX-pme-BY2wJpaLqHs_H0" /><meta name=”keywords” content=”java, openshift, docker, Michal Fabjanski, Fabjanski, github, jekyll, programming, spring, hibernate, spring boot, kubernetes” /><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com"><link rel="dns-prefetch" href="//ajax.googleapis.com"><link rel="dns-prefetch" href="//fonts.gstatic.com"><link rel="dns-prefetch" href="https://dev-diary-2.disqus.com/"><title>Java Recruitment Questions - hashCode() method explained in detail | Devdiaries</title><meta name="generator" content="Jekyll v3.8.4" /><meta property="og:title" content="Java Recruitment Questions - hashCode() method explained in detail" /><meta name="author" content="Michal Fabjanski" /><meta property="og:locale" content="en_US" /><meta name="description" content="Questions about hashCode() are asked on most interviews (from junior to senior level). In this post, you will find out what this method is, how it works for particular types, how it works for primitives, what you have to watch out for during your implementations. Enjoy reading! What is hashCode() method hashCode() is a method that should contain a hash algorithm that calculates a 32-bit integer (hash) from the object data, representing that object. This hash is used by some collections (e.g. HashMap and HashSet) to store references to objects, so that access to data is very fast. Access time depends on the performance of our hash algorithm, so it is worth paying attention to it! Do java primitive types have their hashcode()? Primitive types are not treated the same as ordinary objects. It is not possible to call the hashCode() method on a primitive type. The only option is to use wrappers such as Integer.hashCode(3). Integer.hashCode() returns the value of the int we passed on to the method (in our case 3). Implementation of hashCode from Integer class: public static int hashCode(int value) { return value; } Similar hashcode() functionality exists in the Short and Byte classes. First it casts short/byte to the int and returns its value. A little different hashCode() is in Long. Since Long is a 64-bit number we have to do some “compression” so that we can return the int value: public static int hashCode(long value) { return (int)(value ^ (value &gt;&gt;&gt; 32)); } The &gt;&gt;&gt; is the right shift bit operation. value &gt;&gt;&gt; 32means that we shift 32 bits to right. It leave only 32 bits - and the rest of the position is completed by 0 (32 rightmost bits are discarded). Then, on shifted value a XOR operation is performed ^." /><meta property="og:description" content="Questions about hashCode() are asked on most interviews (from junior to senior level). In this post, you will find out what this method is, how it works for particular types, how it works for primitives, what you have to watch out for during your implementations. Enjoy reading! What is hashCode() method hashCode() is a method that should contain a hash algorithm that calculates a 32-bit integer (hash) from the object data, representing that object. This hash is used by some collections (e.g. HashMap and HashSet) to store references to objects, so that access to data is very fast. Access time depends on the performance of our hash algorithm, so it is worth paying attention to it! Do java primitive types have their hashcode()? Primitive types are not treated the same as ordinary objects. It is not possible to call the hashCode() method on a primitive type. The only option is to use wrappers such as Integer.hashCode(3). Integer.hashCode() returns the value of the int we passed on to the method (in our case 3). Implementation of hashCode from Integer class: public static int hashCode(int value) { return value; } Similar hashcode() functionality exists in the Short and Byte classes. First it casts short/byte to the int and returns its value. A little different hashCode() is in Long. Since Long is a 64-bit number we have to do some “compression” so that we can return the int value: public static int hashCode(long value) { return (int)(value ^ (value &gt;&gt;&gt; 32)); } The &gt;&gt;&gt; is the right shift bit operation. value &gt;&gt;&gt; 32means that we shift 32 bits to right. It leave only 32 bits - and the rest of the position is completed by 0 (32 rightmost bits are discarded). Then, on shifted value a XOR operation is performed ^." /><link rel="canonical" href="https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/" /><meta property="og:url" content="https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/" /><meta property="og:site_name" content="Devdiaries" /><meta property="og:image" content="https://www.devdiaries.net/images/hashcode/hashcode-header-image.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-02-11T00:00:00+00:00" /><script type="application/ld+json"> {"description":"Questions about hashCode() are asked on most interviews (from junior to senior level). In this post, you will find out what this method is, how it works for particular types, how it works for primitives, what you have to watch out for during your implementations. Enjoy reading! What is hashCode() method hashCode() is a method that should contain a hash algorithm that calculates a 32-bit integer (hash) from the object data, representing that object. This hash is used by some collections (e.g. HashMap and HashSet) to store references to objects, so that access to data is very fast. Access time depends on the performance of our hash algorithm, so it is worth paying attention to it! Do java primitive types have their hashcode()? Primitive types are not treated the same as ordinary objects. It is not possible to call the hashCode() method on a primitive type. The only option is to use wrappers such as Integer.hashCode(3). Integer.hashCode() returns the value of the int we passed on to the method (in our case 3). Implementation of hashCode from Integer class: public static int hashCode(int value) { return value; } Similar hashcode() functionality exists in the Short and Byte classes. First it casts short/byte to the int and returns its value. A little different hashCode() is in Long. Since Long is a 64-bit number we have to do some “compression” so that we can return the int value: public static int hashCode(long value) { return (int)(value ^ (value &gt;&gt;&gt; 32)); } The &gt;&gt;&gt; is the right shift bit operation. value &gt;&gt;&gt; 32means that we shift 32 bits to right. It leave only 32 bits - and the rest of the position is completed by 0 (32 rightmost bits are discarded). Then, on shifted value a XOR operation is performed ^.","headline":"Java Recruitment Questions - hashCode() method explained in detail","dateModified":"2020-02-11T00:00:00+00:00","datePublished":"2020-02-11T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/"},"image":"https://www.devdiaries.net/images/hashcode/hashcode-header-image.jpg","url":"https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/","author":{"@type":"Person","name":"Michal Fabjanski"},"@context":"https://schema.org"}</script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> <!-- Replace these icons with your own. --><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/apple-icon-152x152.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/android-icon-192x192.png"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"> <!-- Google Analytics code.<head> tag is the right place for analytics code as directed by Google. This is unofficial light version which loads blazing fast! Implemented for faster page load. --><script src="https://cdn.jsdelivr.net/npm/ga-lite@1/dist/ga-lite.min.js" async></script><script> var galite = galite || {}; galite.UA = 'UA-139553005-1';</script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script></head><body><div class="loader"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div><div class="wrapper"><div class="container-grid"><div class="sidebar"><div class="author-container shadow"><div class="author"><img src="/images/ja.jpg" width="100%" height="auto;" alt="Devdiaries" onclick="location.href='/'"></div><div class="about text-center"><h1 class="title"><a href="/">Devdiaries</a></h1></div><div class="bio text-center"><p class="m0">Michael`s Blog</p></div><hr class="dashed"><div class="social text-center"> <ul class="portfolio p0"> <li><a href="/about/">About Me</a></li> <li><a href="/categories/">Categories</a></li> <li><a href="/contact/">Contact</a></li> </ul> <ul class="sm p0 m0a"> <li><a target="_blank" href="https://www.linkedin.com/in/michal-fabjanski"><i class="fa fa-linkedin"></i></a></li> <li><a target="_blank" href="https://github.com/MichalFab"><i class="fa fa-github"></i></a></li> <li><a target="_blank" href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=michael.fabjanski%40gmail.com&item_name=blog-donation&currency_code=USD&source=url"><i class="fa fa-paypal"></i></a></li> <li><a target="_blank" href="https://www.devdiaries.net/feed.xml"><i class="fa fa-rss"></i></a></li> </ul></div></div></div><div class="main"><div class="main-container shadow"><div class="title-space"> <h2>Java Recruitment Questions - hashCode() method explained in detail</h2></div><hr class="dashed"> <main> <ul class="breadcrumbs"> <li><a href="/">Home</a></li> <li><a href="/blog/">Blog</a></li> <li><a href="#">Java recruitment ...</a></li> </ul><div class="meta"> <p> <small> <span> <i class="fa fa-calendar" aria-hidden="true"></i> 11 Feb 2020&nbsp; </span> <span> <i class="fa fa-user" aria-hidden="true"></i> Michal Fabjanski&nbsp; </span> <span> <i class="fa fa-clock-o" aria-hidden="true"></i> 14 mins read. </span> </small> </p></div><div class="featured-image" style="background-image: url(/images/hashcode/hashcode-header-image.jpg)"></div><article> <ul class="toc rev clearfix"> <li><a href="#what-is-hashcode-method">What is hashCode() method</a></li> <li><a href="#do-java-primitive-types-have-their-hashcode">Do java primitive types have their hashcode()?</a></li> <li><a href="#does-the-java-enums-have-its-hashcode-">Does the Java enums have its hashCode() ?</a></li> <li><a href="#hashcode-method-in-java-arrays">hashCode() method in Java arrays</a></li> <li><a href="#hashcode-method-in-list-map-set">hashCode() method in List, Map, Set</a></li> <li><a href="#hashcode-method-in-string">hashCode() method in String</a></li> <li><a href="#hashcode-method-in-java-objects">hashCode() method in java Objects</a></li> <li><a href="#how-is-the-hashcode-calculated-hashcode-jvm-implementation">How is the hashCode calculated? hashCode() JVM implementation</a></li> <li><a href="#hashcode-own-implementations">hashCode() own implementations</a></li> <li><a href="#additional-hashcode-doubts">Additional hashCode() doubts</a> <ul> <li><a href="#do-i-have-to-implement-hashcodeequals-in-each-class">Do I have to implement hashCode/equals in each class?</a></li> <li><a href="#what-will-be-the-effect-of-badly-implemented-hashcode">What will be the effect of badly implemented hashCode()</a></li> <li><a href="#does-null-have-its-hashcode">Does null have its hashCode?</a></li> </ul> </li> <li><a href="#summary">Summary</a></li> </ul> <p>Questions about <code class="highlighter-rouge">hashCode()</code> are asked on most interviews (from junior to senior level). In this post, you will find out what this method is, how it works for particular types, how it works for primitives, what you have to watch out for during your implementations. Enjoy reading!</p> <h1 id="what-is-hashcode-method">What is hashCode() method</h1> <p><code class="highlighter-rouge">hashCode()</code> is a method that should contain a hash algorithm that calculates a 32-bit integer (hash) from the object data, representing that object.</p> <p>This hash is used by some collections (e.g. HashMap and HashSet) to store references to objects, so that access to data is very fast. Access time depends on the performance of our hash algorithm, so it is worth paying attention to it!</p> <h1 id="do-java-primitive-types-have-their-hashcode">Do java primitive types have their hashcode()?</h1> <p>Primitive types are not treated the same as ordinary objects. It is not possible to call the <code class="highlighter-rouge">hashCode()</code> method on a primitive type. The only option is to use wrappers such as <code class="highlighter-rouge">Integer.hashCode(3)</code>. <code class="highlighter-rouge">Integer.hashCode()</code> returns the value of the int we passed on to the method (in our case 3). Implementation of hashCode from Integer class:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">;</span>    
<span class="o">}</span></code></pre></figure> <p>Similar <code class="highlighter-rouge">hashcode()</code> functionality exists in the <strong>Short</strong> and <strong>Byte</strong> classes. First it casts short/byte to the int and returns its value.<br /> A little different hashCode() is in <strong>Long</strong>. Since Long is a 64-bit number we have to do some “compression” so that we can return the int value:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">         
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="kt">long</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>    
    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">value</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">32</span><span class="o">));</span>    
<span class="o">}</span>  </code></pre></figure> <p>The <code class="highlighter-rouge">&gt;&gt;&gt;</code> is the right shift bit operation. <code class="highlighter-rouge">value &gt;&gt;&gt; 32</code>means that we shift 32 bits to right. It leave only 32 bits - and the rest of the position is completed by 0 (32 rightmost bits are discarded). Then, on shifted value a XOR operation is performed <code class="highlighter-rouge">^</code>.</p> <p>Float numbers are more complicated. Java convert its floating-point values to an equicalent integer value using <code class="highlighter-rouge">Float.floatToIntBits(float value)</code>. The method also checks whether the value is NaN (Not-a-number):</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">     
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="kt">float</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>    
    <span class="k">return</span> <span class="nf">floatToIntBits</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>    
<span class="o">}</span>    
  
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">floatToIntBits</span><span class="o">(</span><span class="kt">float</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>    
    <span class="k">if</span> <span class="o">(!</span><span class="n">isNaN</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>    
        <span class="k">return</span> <span class="nf">floatToRawIntBits</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>    
  <span class="o">}</span>    
    <span class="k">return</span> <span class="mh">0x7fc00000</span><span class="o">;</span>    
<span class="o">}</span>    
    
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isNaN</span><span class="o">(</span><span class="kt">float</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>    
    <span class="k">return</span> <span class="o">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">v</span><span class="o">);</span>    
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">int</span> <span class="nf">floatToRawIntBits</span><span class="o">(</span><span class="kt">float</span> <span class="n">var0</span><span class="o">);</span>  </code></pre></figure> <p>Implementation of <code class="highlighter-rouge">floatToRawIntBits()</code> depend on the JVM/JDK you are using. For openJDK the source is <a href="http://hg.openjdk.java.net/jdk7/jdk7/jdk/file/9b8c96f96a0f/src/share/native/java/lang/Float.c">here</a>.</p> <p><strong>Double</strong> convert its floating-point value to long using <code class="highlighter-rouge">doubleToLongBits()</code> then does the same XOR trick as <code class="highlighter-rouge">Long</code>.</p> <h1 id="does-the-java-enums-have-its-hashcode-">Does the Java enums have its hashCode() ?</h1> <p>Enums uses Object’s <code class="highlighter-rouge">hashCode()</code> . This is the only way to use hashCode() in the enum.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">     
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>    
    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>    
<span class="o">}</span>  </code></pre></figure> <p>In addition, Enum’s hashcode() is <code class="highlighter-rouge">final</code> to prevent developers from creating their own implementations. It is because within one JVM there can exist <strong>only one instance of each enum object</strong> (enums are singletons). This is enough to ensure that such implementation makes sense and is correct.</p> <h1 id="hashcode-method-in-java-arrays">hashCode() method in Java arrays</h1> <p>Arrays do not provide its <code class="highlighter-rouge">hashCode()</code> implementation. Just as enums use a method from the Object class.<br /> It can cause a lot of problems because this hash depends on the magic <a href="https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/#how-is-the-hashcode-calculated-hashcode-jvm-implementation">described below</a>. A better practice is to use <code class="highlighter-rouge">hashCode()</code> from the helper class - <code class="highlighter-rouge">Arrays</code>. <code class="highlighter-rouge">Arrays.hashCode()</code> method returns a hash code based on the contents of the specified array. If the contents of the two arrays are equal then return the same value. You can see an example below:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">     
<span class="kt">int</span> <span class="o">[]</span> <span class="n">numbers1</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">};</span>    
<span class="kt">int</span> <span class="o">[]</span> <span class="n">numbers2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">};</span>    
    
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span> <span class="c1">// return 1595428806    </span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span> <span class="c1">// return 1072408673    </span>
    
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">numbers1</span><span class="o">));</span> <span class="c1">// return 918073252    </span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">numbers2</span><span class="o">));</span> <span class="c1">// return 918073252  </span>
    </code></pre></figure> <p><code class="highlighter-rouge">Arrays</code> class has several hashCode() methods - for primitive types (e.g. hashCode(float a[]), hashCode(int a[])), which inside use type specific hashcode() from the <a href="https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/#do-java-primitive-types-have-their-hashcode">wrapper classes</a>. For other Objects it use:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">    
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="n">Object</span> <span class="n">a</span><span class="o">[])</span> <span class="o">{</span>    
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>    
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>    
    
 <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>    
    
 <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">element</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span>    
        <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="o">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">element</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>    
    
 <span class="k">return</span> <span class="n">result</span><span class="o">;</span>    
<span class="o">}</span>  </code></pre></figure> <p>As you can see, this method adds all the hash from all elements by multiplying them by a multiplier - which in this case is <strong>31</strong>. You may be wondering why we need a multiplier of 31. Thanks to the multiplier, <strong>arrays with the same elements but different order has different hashcodes</strong>. For example, having a table with the elements <code class="highlighter-rouge">[10,20]</code> and <code class="highlighter-rouge">[20,10]</code> - without a multiplier, hashcode for the first table would be: <code class="highlighter-rouge">1 + 10 + 20 = 30</code>, and for the second table: <code class="highlighter-rouge">1 + 20 + 10 = 30</code>. Both tables would have the same hashcode (30) even though the order of their elements is different. With a multiplier, their hashcode is - for the first array: <code class="highlighter-rouge">(31*1 + 10) *31+20 = 1291</code> and for the second array: <code class="highlighter-rouge">(31*1 + 20) *31+10 = 1591</code></p> <p>If you are interested in why the multiplier is 31 - this is described in detail <a href="https://computinglife.wordpress.com/2008/11/20/why-do-hash-functions-use-prime-numbers/">in the article</a>. I recommend reading it!</p> <h1 id="hashcode-method-in-list-map-set">hashCode() method in List, Map, Set</h1> <p><code class="highlighter-rouge">ArrayList</code> and <code class="highlighter-rouge">LinkedList</code> use the same algorithm as <code class="highlighter-rouge">Arrays.hashCode()</code> for the same reason. <code class="highlighter-rouge">Set</code>, unlike List, uses hashcode() without multiplier:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">    
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>    
    <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>    
  <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">();</span>    
 <span class="k">while</span> <span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>    
        <span class="n">E</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>    
 <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>    
            <span class="n">h</span> <span class="o">+=</span> <span class="n">obj</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>    
  <span class="o">}</span>    
    <span class="k">return</span> <span class="n">h</span><span class="o">;</span>    
<span class="o">}</span>  </code></pre></figure> <p>In Set a multiplier is not needed - as the order of the elements does not matter (it is the same). This makes the hashCode calculation a bit faster.</p> <p>In <code class="highlighter-rouge">Maps</code>, hashCode adds all element hashes (element hash is xor from the key hash and hash values).</p> <h1 id="hashcode-method-in-string">hashCode() method in String</h1> <p>This is String class hashCode() implementation:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">    
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>    
 <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">hashIsZero</span><span class="o">)</span> <span class="o">{</span>    
        <span class="n">h</span> <span class="o">=</span> <span class="n">isLatin1</span><span class="o">()</span> <span class="o">?</span> <span class="n">StringLatin1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>    
                       <span class="o">:</span> <span class="n">StringUTF16</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>    
 <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>    
            <span class="n">hashIsZero</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>    
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>    
            <span class="n">hash</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>    
  <span class="o">}</span>    
    <span class="o">}</span>    
    <span class="k">return</span> <span class="n">h</span><span class="o">;</span>    
<span class="o">}</span>  </code></pre></figure> <p>If the string has Latin encoding, the <code class="highlighter-rouge">StringLatin1.hashCode</code> method is used, and if the string is UTF-16 encoding, the hashcode will be generated in <code class="highlighter-rouge">tringUTF16.hashCode</code>. The difference is that in <strong>latin1</strong> each <strong>character</strong> is exactly <strong>one byte</strong> long. In utf8 a <strong>character</strong> can consist of more than <strong>one byte</strong>. Inside, the hashCode calculating functionality is the same as in List or <code class="highlighter-rouge">Arrays.hashCode()</code>.<br /> The advantage of the <code class="highlighter-rouge">hashCode</code> from the String class is that the <strong>hashcode value is cached and calculated lazily during the first call of the method</strong>.</p> <h1 id="hashcode-method-in-java-objects">hashCode() method in java Objects</h1> <p>If your class hasn’t overridden the <code class="highlighter-rouge">hashCode()</code> method, then it will use the one defined in its super class, probably in the <code class="highlighter-rouge">Object</code> class. <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html#hashCode%28%29">hashCode()</a> in Object class is a native function (<strong>is dependant on the JVM</strong>). Documentation says :</p> <blockquote> <p>As much as is reasonably practical, the hashCode method defined by class Object does return distinct integers for distinct objects. (This is typically implemented by converting the internal address of the object into an integer, but this implementation technique is not required by the JavaTM programming language.)</p> </blockquote> <p>It is hard to guess how exactly <code class="highlighter-rouge">hashCode()</code> works, as its implementation is placed in the native code of the JVM. In many places, you can find information that <code class="highlighter-rouge">hashCode()</code> is simply an address in memory. Given that the JVM can relocate objects (e.g. during garbage collection cycles due to promotion or compaction) - after we calculate an object’s identity hash we must be able to retain it in a way that survives object relocation.<br /> One solution is to write the hashcode calculated during the first call of the <code class="highlighter-rouge">hashCode()</code> method into the object data (e.g object header). This way, if the object is moved to another memory area, it will still have the same, original hashcode. But despite the fact that it is often believed that - this is not the functionality of the most popular JVM implementation - OpenJDK…</p> <h1 id="how-is-the-hashcode-calculated-hashcode-jvm-implementation">How is the hashCode calculated? hashCode() JVM implementation</h1> <p>If we go deeper, to the JVM code (the implementation can be found <a href="http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/87ee5ee27509/src/share/vm/prims/jvm.cpp">here</a> - line 511) we can deduce that the <strong>hashCode is not calculated from the address in the memory but from the thread state!</strong> You can find proof of that on <a href="https://stackoverflow.com/questions/1961146/memory-address-of-variables-in-java/20680667#20680667">StackOverflow</a>.<br /> There are two important things to remember. First of all, such hashCode calculating exist from OpenJDK 8. Secondly, hashCode calculating is implementation-dependent. In this post we checked OpenJDK. For comparison - J<a href="https://www.azul.com/products/zing/">VM Zing implementation</a> calculates hashCode based on a memory address. <br /> This can be considered a tricky recruitment question! :)</p> <h1 id="hashcode-own-implementations">hashCode() own implementations</h1> <p>Finally, it is important to mention the good practices when creating your own hashCode().<br /> I will share with you the 3 most common ways to create your own hashCode():</p> <ol> <li>Using IDE (e.g. generating in IntelliJ, you can press ALT + Insert and select “equals and hashCode” from the context menu).</li> <li>Using libraries. For example, Lombok library, which will generate <code class="highlighter-rouge">hashCode()</code> during compilation.</li> <li>Writing your own implementation of <code class="highlighter-rouge">hashCode()</code> - you must be careful not to make a mistake. A wrong <code class="highlighter-rouge">hashCode()</code> can spoil the effectiveness of HashMap and bring many problems!</li> </ol> <p>A simple example! Everyone likes simple examples! We have a well-known Person class:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">    
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">surname</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">surname</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">surname</span> <span class="o">=</span> <span class="n">surname</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">surname</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>  </code></pre></figure> <p>Remember that when overwriting the <code class="highlighter-rouge">hashCode()</code> method you must also overwrite the <code class="highlighter-rouge">equals()</code> method, so as not to break the hashCode() &amp; equals() contract. The equals and hashCode methods should meet the following conditions:<br /> If <strong>x == y then x.equals(y) == true</strong><br /> If <strong>x.equals(y) == true then x.hashCode() == y.hashCode()</strong><br /> If <strong>x.hashCode() == y.hashCode() then x.equals(y) can either return true or return false</strong><br /> The last point is based on int scope (hashCode() returns int value). As a result, <code class="highlighter-rouge">hashCode()</code> can return a finite number of results: from -2 147 483 648 to +2 147 483 647 - so, around 4 billion unique values. Let’s imagine, that we are building the application, that keeps more data. If we start invoking the <code class="highlighter-rouge">hashCode()</code> method from more than 4 billion elements, it is possible, that first 4 billion ones will produce a unique result, but each next call will produce the integer value, that has been produced before. Therefore, it is important to combine <code class="highlighter-rouge">hashCode()</code> with <code class="highlighter-rouge">equals()</code> to make sure that objects that have the same hashcodes are not different.</p> <h1 id="additional-hashcode-doubts">Additional hashCode() doubts</h1> <h2 id="do-i-have-to-implement-hashcodeequals-in-each-class">Do I have to implement hashCode/equals in each class?</h2> <p>Answer: No, if you don’t expect to use the <code class="highlighter-rouge">equals</code> method (e.g., aren’t using <code class="highlighter-rouge">assertEquals</code> from JUnit, or never mean to use this class as a key in a <code class="highlighter-rouge">Map</code>, etc), the implementation will not be used -&gt; it not necessary.</p> <h2 id="what-will-be-the-effect-of-badly-implemented-hashcode">What will be the effect of badly implemented hashCode()</h2> <p>Anwer: Even if in hashCode you will return the same int for each element, e.g:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">    
<span class="nd">@Override</span>    
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>    
    <span class="k">return</span> <span class="mi">123</span><span class="o">;</span>    
<span class="o">}</span>  </code></pre></figure> <p>Your program will compile and run. The problem can be when you want to use collections using hashCode (HashMap, HashSet or other). In the above example hashCode - all elements will be placed into the same bucket in HashMap (as LinkedList elements). Effectiveness will decrease significantly.</p> <h2 id="does-null-have-its-hashcode">Does null have its hashCode?</h2> <p>Of course you can’t call the <code class="highlighter-rouge">hashCode()</code> method (like any other method) on null value. But we can pass null to <code class="highlighter-rouge">Objects.hashCode()</code>:</p> <figure class="highlight"><pre><code class="language-java" data-lang="java">    
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">return</span> <span class="n">o</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">o</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>  
<span class="o">}</span>  </code></pre></figure> <p>As you can see, Objects.hashCode() for null will return 0. You’re probably wondering how HashMap’s doing in that case. <code class="highlighter-rouge">HashMap</code> has a <a href="https://stackoverflow.com/questions/17268212/hashcode-for-null-key-in-hashmap">special handling</a> for <code class="highlighter-rouge">null</code> keys. <code class="highlighter-rouge">null</code> values are fine as you don’t compute hash code for them in a <code class="highlighter-rouge">HashMap</code>. This is the reason why <code class="highlighter-rouge">null</code> keys work fine in <code class="highlighter-rouge">HashMap</code>.</p> <h1 id="summary">Summary</h1> <p>I hope you liked the article. If you have any questions, please feel free to comment. Thank you for your comments under the <a href="https://www.devdiaries.net/blog/Java-Recruitment-Questions-Immutable-Objects/">last post</a> :)</p> </article> <hr class="dashed"><div class="row rev"><div class="col-md-12"><div class="share-box"> <i class="fa fa-share-alt" aria-hidden="true"></i> <a class="f nostyle" href="https://www.facebook.com/sharer/sharer.php?u=https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-facebook-official fa"></i></a> <a class="t nostyle" href="https://twitter.com/intent/tweet?text=&url=https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i></a> <a class="g nostyle" href="https://plus.google.com/share?url=https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-google-plus fa"></i></a> <a class="r nostyle" href="http://www.reddit.com/submit?url=https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-reddit fa"></i></a> <a class="l nostyle" href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/&title=&summary=&source=dev-diary.github.io" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-linkedin fa"></i></a> <a class="e nostyle" href="mailto:?subject=&amp;body=Check&amp;out&amp;this&amp;site&amp;https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/"><i class="fa fa-envelope fa"></i></a></div><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" style="text-align: center;"> <input type="hidden" name="cmd" value="_donations" /> <input type="hidden" name="business" value="michael.fabjanski@gmail.com" /> <input type="hidden" name="item_name" value="blog-donation" /> <input type="hidden" name="currency_code" value="USD" /> <input type="image" src="https://github.com/MichalFab/students-day/blob/master/donate2.png?raw=true" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" /> <img alt="" border="0" src="https://www.paypal.com/en_PL/i/scr/pixel.gif" width="1" height="1" /> </form></div></div><div class="row"><div class="col-md-12"> <p class="categories rev"> <span><a href="/categories/#java">Java</a></span> <span><a href="/categories/#interview">Interview</a></span></p></div></div><div id="disqus_thread"></div><script> var disqus_config = function () { this.page.url = 'https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/'; this.page.identifier = 'https://www.devdiaries.net/blog/Java-Recruitment-Questions-HashCode/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://dev-diary-2.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <!--<div class="comment-loader">--> <!--<button class="comments cards">Comments</button>--> <!--</div>--> <!--<div class="disqus hide">Loading comments&hellip;</div>--> <!--<div class="disqus-loading"></div>--> <!--<script>--> <!--/*--> <!-- disqusLoader.js v1.0--> <!-- A JavaScript plugin for lazy-loading Disqus comments widget.--> <!-- - --> <!-- By Osvaldas Valutis, www.osvaldas.info--> <!-- Available for use under the MIT License--> <!--*/--> <!--(function(b,f,l){var r=function(a){a=a.getBoundingClientRect();return{top:a.top+f.body.scrollTop,left:a.left+f.body.scrollLeft}},t=function(a,c){var d=f.createElement("script");d.src=a;d.async=!0;d.setAttribute("data-timestamp",+new Date);d.addEventListener("load",function(){"function"===typeof c&&c()});(f.head||f.body).appendChild(d)};l=function(a,c){var d,e;return function(){var g=this,f=arguments,b=+new Date;d&&b<d+a?(clearTimeout(e),e=setTimeout(function(){d=b;c.apply(g,f)},a)):(d=b,c.apply(g,--> <!--f))}};var m=!1,n=!1,p=!1,k=!1,h="unloaded",e=!1,q=function(){if(!e||!f.body.contains(e)||"loaded"==e.disqusLoaderStatus)return!0;var a=b.pageYOffset,c=r(e).top;if(c-a>b.innerHeight*n||0<a-c-e.offsetHeight-b.innerHeight*n)return!0;(a=f.getElementById("disqus_thread"))&&a.removeAttribute("id");e.setAttribute("id","disqus_thread");e.disqusLoaderStatus="loaded";"loaded"==h?DISQUS.reset({reload:!0,config:p}):(b.disqus_config=p,"unloaded"==h&&(h="loading",t(k,function(){h="loaded"})))};b.addEventListener("scroll",--> <!--l(m,q));b.addEventListener("resize",l(m,q));b.disqusLoader=function(a,c){var d={laziness:1,throttle:250,scriptUrl:!1,disqusConfig:!1},b=c,g,h={};for(g in d)Object.prototype.hasOwnProperty.call(d,g)&&(h[g]=d[g]);for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&(h[g]=b[g]);c=h;n=c.laziness+1;m=c.throttle;p=c.disqusConfig;k=!1===k?c.scriptUrl:k;e="string"===typeof a?f.querySelector(a):"number"===typeof a.length?a[0]:a;e.disqusLoaderStatus="unloaded";q()}})(window,document,0);--> <!--</script>--> <!--<script>--> <!-- disqusLoader( '.disqus',--> <!-- {--> <!-- scriptUrl: '//{"shortname"=>"dev-diary-2"}.disqus.com/embed.js',--> <!-- disqusConfig: function()--> <!-- {--><script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script> $(document).ready(function () { $(".loader").hide(); });</script><script> $("#search-input").keyup(function () { $("main").hide(); $("search-container").show(); if (!$('#search-input').val()) { $("main").show(); $("search-container").hide(); } });</script><script src="/js/jekyll-search.min.js" type="text/javascript"></script><script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-container'), searchResultTemplate: '<a class="nostyle" href="{url}"><div class="blog borders cards"><div class="image" style="background-image: url({image});"></div><div class="content"><h3 class="title">{title}</h3><p class="description">{description}</p></div></div></a>', noResultsText: 'No results found', json: '/search.json' })</script><script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script><script> AOS.init({ duration: 600, once: true, disable: 'mobile' });</script><script> $("button").click(function () { $(".disqus").toggle(); $(".comments").toggle(); });</script></body></html>