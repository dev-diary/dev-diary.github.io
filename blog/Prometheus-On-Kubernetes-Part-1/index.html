<!-- This layout is used in all pages. Making changes here will efect all pages. We recommend not to change anything here. --> <!DOCTYPE html><html lang="en"> <!----><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="Cghc1HFx2GBn1D5ans5vLlaX-pme-BY2wJpaLqHs_H0" /><meta name=”keywords” content=”java, openshift, docker, Michal Fabjanski, Fabjanski, github, jekyll, programming, spring, hibernate, spring boot, kubernetes” /><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com"><link rel="dns-prefetch" href="//ajax.googleapis.com"><link rel="dns-prefetch" href="//fonts.gstatic.com"><link rel="dns-prefetch" href="https://dev-diary-2.disqus.com/"><title>A quick introduction to Prometheus. Metrics on Kubernetes with grok exporter - Part 1 | Devdiaries</title><meta name="generator" content="Jekyll v3.8.4" /><meta property="og:title" content="A quick introduction to Prometheus. Metrics on Kubernetes with grok exporter - Part 1" /><meta name="author" content="Michal Fabjanski" /><meta property="og:locale" content="en_US" /><meta name="description" content="Prometheus is one of the most popular open-source systems for monitoring and alerting. Very often it is used to collect data from microservices in Kubernetes. In this series you will learn the main blocks of Prometheus: metrics and labels, push and pull information exchange. You will learn how to use Prometheus without changing the application code. We will generate metrics based on logs (in our case, performance logs)." /><meta property="og:description" content="Prometheus is one of the most popular open-source systems for monitoring and alerting. Very often it is used to collect data from microservices in Kubernetes. In this series you will learn the main blocks of Prometheus: metrics and labels, push and pull information exchange. You will learn how to use Prometheus without changing the application code. We will generate metrics based on logs (in our case, performance logs)." /><link rel="canonical" href="https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/" /><meta property="og:url" content="https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/" /><meta property="og:site_name" content="Devdiaries" /><meta property="og:image" content="https://www.devdiaries.net/images/prometheus-kubernetes/prometheus-kubernetes1.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-08-21T00:00:00+00:00" /><script type="application/ld+json"> {"description":"Prometheus is one of the most popular open-source systems for monitoring and alerting. Very often it is used to collect data from microservices in Kubernetes. In this series you will learn the main blocks of Prometheus: metrics and labels, push and pull information exchange. You will learn how to use Prometheus without changing the application code. We will generate metrics based on logs (in our case, performance logs).","headline":"A quick introduction to Prometheus. Metrics on Kubernetes with grok exporter - Part 1","dateModified":"2019-08-21T00:00:00+00:00","datePublished":"2019-08-21T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/"},"image":"https://www.devdiaries.net/images/prometheus-kubernetes/prometheus-kubernetes1.jpg","url":"https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/","author":{"@type":"Person","name":"Michal Fabjanski"},"@context":"https://schema.org"}</script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> <!-- Replace these icons with your own. --><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/apple-icon-152x152.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/android-icon-192x192.png"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"> <!-- Google Analytics code.<head> tag is the right place for analytics code as directed by Google. This is unofficial light version which loads blazing fast! Implemented for faster page load. --><script src="https://cdn.jsdelivr.net/npm/ga-lite@1/dist/ga-lite.min.js" async></script><script> var galite = galite || {}; galite.UA = 'UA-139553005-1';</script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script></head><body><div class="loader"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div><div class="wrapper"><div class="container-grid"><div class="sidebar"><div class="author-container shadow"><div class="author"><img src="/images/ja.jpg" width="100%" height="auto;" alt="Devdiaries" onclick="location.href='/'"></div><div class="about text-center"><h1 class="title"><a href="/">Devdiaries</a></h1></div><div class="bio text-center"><p class="m0">Michael`s Blog</p></div><hr class="dashed"><div class="social text-center"> <ul class="portfolio p0"> <li><a href="/about/">About Me</a></li> <li><a href="/categories/">Categories</a></li> <li><a href="/contact/">Contact</a></li> </ul> <ul class="sm p0 m0a"> <li><a target="_blank" href="https://www.linkedin.com/in/michal-fabjanski"><i class="fa fa-linkedin"></i></a></li> <li><a target="_blank" href="https://github.com/MichalFab"><i class="fa fa-github"></i></a></li> <li><a target="_blank" href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=michael.fabjanski%40gmail.com&item_name=blog-donation&currency_code=USD&source=url"><i class="fa fa-paypal"></i></a></li> <li><a target="_blank" href="https://www.devdiaries.net/feed.xml"><i class="fa fa-rss"></i></a></li> </ul></div></div></div><div class="main"><div class="main-container shadow"><div class="title-space"> <h2>A quick introduction to Prometheus. Metrics on Kubernetes with grok exporter - Part 1</h2></div><hr class="dashed"> <main> <ul class="breadcrumbs"> <li><a href="/">Home</a></li> <li><a href="/blog/">Blog</a></li> <li><a href="#">Prometheus on kub...</a></li> </ul><div class="meta"> <p> <small> <span> <i class="fa fa-calendar" aria-hidden="true"></i> 21 Aug 2019&nbsp; </span> <span> <i class="fa fa-user" aria-hidden="true"></i> Michal Fabjanski&nbsp; </span> <span> <i class="fa fa-clock-o" aria-hidden="true"></i> 3 mins read. </span> </small> </p></div><div class="featured-image" style="background-image: url(/images/prometheus-kubernetes/prometheus-kubernetes1.jpg)"></div><article> <ul class="toc rev clearfix"> <li><a href="#prometheus-metrics-and-labels">Prometheus metrics and labels</a></li> <li><a href="#metrics-types">Metrics types</a> <ul> <li><a href="#counter">Counter</a></li> <li><a href="#gauge">Gauge</a></li> <li><a href="#histogram">Histogram</a></li> <li><a href="#summary">Summary</a></li> </ul> </li> <li><a href="#push-and-pull-prometheus-model">Push and Pull Prometheus model</a> <ul> <li><a href="#push">Push</a></li> <li><a href="#pull">Pull</a></li> </ul> </li> <li><a href="#exposing-and-scraping-metrics">Exposing and scraping metrics</a></li> <li><a href="#exporting-metrics-using-side-cars-containers">Exporting metrics using side-cars containers</a></li> <li><a href="#summary-1">Summary</a></li> </ul> <p>Prometheus is one of the most popular open-source systems for monitoring and alerting. Very often it is used to collect data from microservices in Kubernetes. In this series you will learn the main blocks of Prometheus: <strong>metrics and labels</strong>, <strong>push and pull</strong> information exchange. You will learn how to use Prometheus <strong>without changing the application code</strong>. We will generate metrics based on <strong>logs</strong> (in our case, performance logs).</p> <h3 id="prometheus-metrics-and-labels">Prometheus metrics and labels</h3> <p>Metrics are the main concept of Prometheus. Instrumented applications expose them by HTTP endpoint or JMX. Prometheus “scrapes” and stores them in the time-series database. This means that it works very well in a distributed, cloud-native environment. All of the services are unburdened by a load on the monitoring system. <strong>Metric</strong> is an identifier of data collected by Prometheus. The <strong>metric</strong> specifies the general feature of a system that is measured - for example <code class="highlighter-rouge">http_requests_total</code> - the total number of HTTP requests received. <strong>Labels</strong> can be added to each data point to specify which service this counter applies to:</p> <p>Imagine a request counter that looks like this:</p> <p><code class="highlighter-rouge">http_requests_total{service="spring-app"}</code></p> <p>There are many spring-app instances in the cluster so we should add another label - instance:</p> <p><code class="highlighter-rouge">http_requests_total{service="spring-app", instance="spring-app-1"}</code></p> <p>We can add many other labels that accurately describe the request (HTTP method, endpoint, response HTTP status). <strong>Metrics with good labels are key to the best use of Prometheus.</strong></p> <h3 id="metrics-types">Metrics types</h3> <h4 id="counter">Counter</h4> <p>It is the most popular metric type. <strong>Counter</strong> is an incremental value or zero (after initialization/restart). It is most often used to measure the number of requests, errors.</p> <h4 id="gauge">Gauge</h4> <p><strong>Gauge</strong> is the incremental/decremental value that changes over time. It is used for memory or CPU usage statistics.</p> <h4 id="histogram">Histogram</h4> <p>Metrics such as response time are most commonly monitored using <strong>histograms</strong>. Before starting measurements, we must first define the possible ranges of results. In the case of measuring the response time, it can be: below one second, between 1 second and 2 seconds, between 2 and 10 and above 10. Then we assign the observed value to the matching range.</p> <h4 id="summary">Summary</h4> <p>The <strong>Summary</strong> type works very much like a histogram, but it is slightly more extensive, e.g. it stores information about the total number of observations.,</p> <h3 id="push-and-pull-prometheus-model">Push and Pull Prometheus model</h3> <p>The monitoring system based on Prometheus can collect metrics in two main ways: <strong>push or pull</strong> models.</p> <h4 id="push">Push</h4> <p>In push model applications are active and they are responsible for <strong>sending collected records to Prometheus</strong> via <strong>Pushgateway</strong>. This model works best for gathering information, e.g. with test results, or other cyclical tasks that can be performed irregularly and for a longer period.</p> <h4 id="pull">Pull</h4> <p>In this model, the application is passive and only <strong>prepares its metrics in the form of an endpoint</strong>. Prometheus decides when to download them. This approach is recommended by application developers and should be used in most cases.</p> <h3 id="exposing-and-scraping-metrics">Exposing and scraping metrics</h3> <p>Most languages have an implementation of Prometheus client with functionalities for:</p> <ul> <li> <p>Getting metrics for the language (JVM metrics, GC metrics, Go metrics)</p> </li> <li> <p>Possibility to registry custom metrics</p> </li> <li> <p>HTTP handler to create and expose metrics on the /metrics endpoint</p> <p>Prometheus scrapes each target regularly (the frequency of meter reading is set by <em>scrape interval</em> property)</p> </li> </ul> <h3 id="exporting-metrics-using-side-cars-containers">Exporting metrics using side-cars containers</h3> <p>Sometimes it is impossible to instrument application at the code level. In this case, the best solution is to use exporters as <strong>side-car</strong> containers. The most popular are <a href="https://github.com/prometheus/node_exporter">Node exporter</a> and <a href="https://github.com/fstab/grok_exporter">Grok exporter</a> which can read system metrics (CPU, memory…) and expose them for Prometheus.</p> <h3 id="summary-1">Summary</h3> <p>You’ve read the basics of Prometheus. You should have a better understanding of what Prometheus is and how it works. You will need this knowledge in the <a href="https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-2/">next post</a>. I will show you how to use Grok exporter to instrument Java application based on application logs.</p> </article> <hr class="dashed"><div class="row rev"><div class="col-md-12"><div class="share-box"> <i class="fa fa-share-alt" aria-hidden="true"></i> <a class="f nostyle" href="https://www.facebook.com/sharer/sharer.php?u=https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-facebook-official fa"></i></a> <a class="t nostyle" href="https://twitter.com/intent/tweet?text=&url=https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i></a> <a class="g nostyle" href="https://plus.google.com/share?url=https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-google-plus fa"></i></a> <a class="r nostyle" href="http://www.reddit.com/submit?url=https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-reddit fa"></i></a> <a class="l nostyle" href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/&title=&summary=&source=dev-diary.github.io" onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" ><i class="fa fa-linkedin fa"></i></a> <a class="e nostyle" href="mailto:?subject=&amp;body=Check&amp;out&amp;this&amp;site&amp;https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/"><i class="fa fa-envelope fa"></i></a></div><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" style="text-align: center;"> <input type="hidden" name="cmd" value="_donations" /> <input type="hidden" name="business" value="michael.fabjanski@gmail.com" /> <input type="hidden" name="item_name" value="blog-donation" /> <input type="hidden" name="currency_code" value="USD" /> <input type="image" src="https://github.com/MichalFab/students-day/blob/master/donate2.png?raw=true" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" /> <img alt="" border="0" src="https://www.paypal.com/en_PL/i/scr/pixel.gif" width="1" height="1" /> </form></div></div><div class="row"><div class="col-md-12"> <p class="categories rev"> <span><a href="/categories/#kubernetes">Kubernetes</a></span> <span><a href="/categories/#prometheus">Prometheus</a></span></p></div></div><div id="disqus_thread"></div><script> var disqus_config = function () { this.page.url = 'https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/'; this.page.identifier = 'https://www.devdiaries.net/blog/Prometheus-On-Kubernetes-Part-1/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://dev-diary-2.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <!--<div class="comment-loader">--> <!--<button class="comments cards">Comments</button>--> <!--</div>--> <!--<div class="disqus hide">Loading comments&hellip;</div>--> <!--<div class="disqus-loading"></div>--> <!--<script>--> <!--/*--> <!-- disqusLoader.js v1.0--> <!-- A JavaScript plugin for lazy-loading Disqus comments widget.--> <!-- - --> <!-- By Osvaldas Valutis, www.osvaldas.info--> <!-- Available for use under the MIT License--> <!--*/--> <!--(function(b,f,l){var r=function(a){a=a.getBoundingClientRect();return{top:a.top+f.body.scrollTop,left:a.left+f.body.scrollLeft}},t=function(a,c){var d=f.createElement("script");d.src=a;d.async=!0;d.setAttribute("data-timestamp",+new Date);d.addEventListener("load",function(){"function"===typeof c&&c()});(f.head||f.body).appendChild(d)};l=function(a,c){var d,e;return function(){var g=this,f=arguments,b=+new Date;d&&b<d+a?(clearTimeout(e),e=setTimeout(function(){d=b;c.apply(g,f)},a)):(d=b,c.apply(g,--> <!--f))}};var m=!1,n=!1,p=!1,k=!1,h="unloaded",e=!1,q=function(){if(!e||!f.body.contains(e)||"loaded"==e.disqusLoaderStatus)return!0;var a=b.pageYOffset,c=r(e).top;if(c-a>b.innerHeight*n||0<a-c-e.offsetHeight-b.innerHeight*n)return!0;(a=f.getElementById("disqus_thread"))&&a.removeAttribute("id");e.setAttribute("id","disqus_thread");e.disqusLoaderStatus="loaded";"loaded"==h?DISQUS.reset({reload:!0,config:p}):(b.disqus_config=p,"unloaded"==h&&(h="loading",t(k,function(){h="loaded"})))};b.addEventListener("scroll",--> <!--l(m,q));b.addEventListener("resize",l(m,q));b.disqusLoader=function(a,c){var d={laziness:1,throttle:250,scriptUrl:!1,disqusConfig:!1},b=c,g,h={};for(g in d)Object.prototype.hasOwnProperty.call(d,g)&&(h[g]=d[g]);for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&(h[g]=b[g]);c=h;n=c.laziness+1;m=c.throttle;p=c.disqusConfig;k=!1===k?c.scriptUrl:k;e="string"===typeof a?f.querySelector(a):"number"===typeof a.length?a[0]:a;e.disqusLoaderStatus="unloaded";q()}})(window,document,0);--> <!--</script>--> <!--<script>--> <!-- disqusLoader( '.disqus',--> <!-- {--> <!-- scriptUrl: '//{"shortname"=>"dev-diary-2"}.disqus.com/embed.js',--> <!-- disqusConfig: function()--> <!-- {--><script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script> $(document).ready(function () { $(".loader").hide(); });</script><script> $("#search-input").keyup(function () { $("main").hide(); $("search-container").show(); if (!$('#search-input').val()) { $("main").show(); $("search-container").hide(); } });</script><script src="/js/jekyll-search.min.js" type="text/javascript"></script><script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-container'), searchResultTemplate: '<a class="nostyle" href="{url}"><div class="blog borders cards"><div class="image" style="background-image: url({image});"></div><div class="content"><h3 class="title">{title}</h3><p class="description">{description}</p></div></div></a>', noResultsText: 'No results found', json: '/search.json' })</script><script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script><script> AOS.init({ duration: 600, once: true, disable: 'mobile' });</script><script> $("button").click(function () { $(".disqus").toggle(); $(".comments").toggle(); });</script></body></html>